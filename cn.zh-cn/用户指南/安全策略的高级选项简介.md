# 安全策略的高级选项简介<a name="ZH-CN_TOPIC_0111166350"></a>

高级选项的配置主要包含查询模式组、学习模式、注入模式、风险概况、风险引擎和正则模式库等模块的配置。基于以上配置，可创建学习模式规则、数据防火墙规则或者基于风险的IPS/IDS规则。

## 查询模式组<a name="zh-cn_topic_0180960096_section5454024142817"></a>

SQL语句可被定义为查询模式组，并可以创建基于查询模式组的数据库防火墙规则。

## 学习模式<a name="zh-cn_topic_0180960096_section6978194971219"></a>

HexaTier策略有自学习模式，一旦定义的学习时间结束后，系统会生成一个附有学习到的模式的学习模式库，用户可以基于此学习模式库来创建查询模式组，并以此查询模式组创建允许或阻止的数据库防火墙规则。

## 注入模式<a name="zh-cn_topic_0180960096_section2752651172116"></a>

HexaTier通过对比查询语句结构与不断更新的已知攻击签名库来识别恶意攻击。可疑攻击被自动定义为注入模式（本质上是SQL语句）。

用户可以将注入模式转换为正则表达式模式，并将其添加进查询模式组中，应用于基于查询模式组的数据库防火墙规则。

## 风险概况<a name="zh-cn_topic_0180960096_section14435132917129"></a>

创建基于风险的IPS/IDS策略时，建议创建一个风险概况作为识别威胁的基础。详情请参见[配置风险概况](配置风险概况.md#ZH-CN_TOPIC_0111166352)。

用户可以为特定类型的威胁定义风险概况，例如，用户可以创建识别所有尝试对MySQL数据库进行修改的风险概况。

## 风险引擎<a name="zh-cn_topic_0180960096_section167481354123"></a>

风险引擎定义了对SQL注入攻击的防护，用户可以分别配置阻止级别和警告级别的风险评分，来应用基于风险的IPS/IDS策略。

若用户配置了“主动防护-IPS“模式，则系统根据配置的阻止级别和警告级别风险评分，分别执行阻止和允许操作，若用户配置了“监控-IDS“模式，则只依据警告级别风险评分，允许用户查询并发送告警。

用户也可以调整每个风险因素的权重评分，详情请参见[配置风险引擎](配置风险引擎.md#ZH-CN_TOPIC_0111166556)。

## 正则表达式模式<a name="zh-cn_topic_0180960096_section969744319121"></a>

正则表达式模式可以添加进查询模式组中，来创建基于查询模式组的数据库防火墙规则。

用户可以自定义正则表达式，也可以通过学习到的模式和注入模式来创建正则表达式模式。

正则表达式（Regex）以简洁灵活的方式来“匹配”（指定和识别）文本字符串，例如特定字符、单词或字符模式。

-   **Regex标识**

    使用以下正则表达式标识：

    -   PCRE\_DOTALL：模式中的点元字符匹配所有字符，包括换行符。
    -   PCRE\_CASELESS：模式中的字母匹配大写和小写字母。
    -   PCRE\_NEWLINE\_ANY：指定识别unicode换行序列。
    -   PCRE\_UTF8：此修饰符打开PCRE的附加功能，此功能与Perl不兼容。模式和主题字符串被视为UTF-8。

-   **Regex锚点**

    正则表达式在整个SQL字符串上进行测试。如果“^”和“$”锚点丢失，HexaTier会自动将“**^**”添加到表达式字符串的开头，将“$”锚点添加到字符串的末尾。

-   **SQL注释**

    SQL语句与正则表达式模板相匹配时，忽略SQL注释。SQL注释的语法差异，取决于用户正在使用的数据库类型。

-   **存储过程**

    正则表达式与存储过程内容匹配。

    例如：EXEC SP\_DEMO与任何以EXEC SP\_DEMO开头的字符串相匹配。


