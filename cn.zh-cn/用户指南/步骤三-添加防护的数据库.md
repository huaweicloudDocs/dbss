# 步骤三：添加防护的数据库<a name="ZH-CN_TOPIC_0111166540"></a>

受保护的数据库指在HexaTier中配置连接并被保护的数据库实例。创建受保护数据库后，用户就可以通过HexaTier控制台进行相关配置，启用敏感数据发现、防拖库、数据库防火墙、数据库活动监控和动态数据脱敏等功能。

## 前提条件<a name="zh-cn_topic_0180960136_s85b8a26a1d8846fbba93dfd084c558a4"></a>

-   确保数据库服务器上的SQL服务正在运行。
-   确保数据库服务器正常联网。

## 注意事项<a name="zh-cn_topic_0180960136_section137013451197"></a>

创建受保护的数据库之后，用户需要更改应用连接的数据库IP地址和端口为HexaTier代理的IP地址和端口。

## 操作步骤<a name="zh-cn_topic_0180960136_s2659a50434384a61847756cf6027f944"></a>

1.  在HexaTier主菜单上，单击“资源“。
2.  在导航树上，选择“受保护数据库“。
3.  执行下列操作之一：
    -   创建新的受保护数据库

        在命令栏上，单击“新建“，选择以下数据库类型：

        -   MS-SQL
        -   MySQL
        -   PostgreSQL
        -   LibrA/DWS

        >![](public_sys-resources/icon-note.gif) **说明：**   
        >-   对于使用MS-SQL的受保护数据库的Kerberos支持，用户必须首先配置活动目录。  
        >-   使用MS-SQL的受保护数据库仅在实例级别区分大小写。  
        >-   配置DDM为受保护的数据库，请参见[步骤三：添加防护的DDM](步骤三-添加防护的DDM.md)。  
        >-   LibrA是基于PostgreSQL数据库内核引擎研发的企业级MPP架构的分布式数据仓库。FusionInsight LibrA和DWS是基于LibrA内核研发的数据库产品。数据库类型“LibrA/DWS“：  
        >    -   LibrA：即FusionInsight LibrA，是私有云数据仓库产品。  
        >    -   DWS：DWS（Data Warehouse Service，数据仓库服务）是管理控制台数据仓库服务。  
        >    -   在HexaTier内部，统一使用LibrA作为数据库类型选项，即LibrA既代表FusionInsight LibrA，也代表DWS。  

    -   编辑已有受保护数据库

        找到要编辑的受保护数据库，然后单击该行末尾的![](figures/icon-edit.png)（编辑）。

4.  根据需要设置参数：

    **图 1**  受保护数据库配置图<a name="zh-cn_topic_0180960136_fig160115218445"></a>  
    ![](figures/受保护数据库配置图.png "受保护数据库配置图")

    **表 1**  数据库参数

    <a name="zh-cn_topic_0180960136_table14825355114914"></a>
    <table><thead align="left"><tr id="zh-cn_topic_0180960136_row1832105515493"><th class="cellrowborder" valign="top" width="23.68%" id="mcps1.2.3.1.1"><p id="zh-cn_topic_0180960136_p1783513557499"><a name="zh-cn_topic_0180960136_p1783513557499"></a><a name="zh-cn_topic_0180960136_p1783513557499"></a>参数名称</p>
    </th>
    <th class="cellrowborder" valign="top" width="76.32%" id="mcps1.2.3.1.2"><p id="zh-cn_topic_0180960136_p884065594914"><a name="zh-cn_topic_0180960136_p884065594914"></a><a name="zh-cn_topic_0180960136_p884065594914"></a>说明</p>
    </th>
    </tr>
    </thead>
    <tbody><tr id="zh-cn_topic_0180960136_row8843155564919"><td class="cellrowborder" valign="top" width="23.68%" headers="mcps1.2.3.1.1 "><p id="zh-cn_topic_0180960136_p1184545515494"><a name="zh-cn_topic_0180960136_p1184545515494"></a><a name="zh-cn_topic_0180960136_p1184545515494"></a>数据库服务器地址</p>
    </td>
    <td class="cellrowborder" valign="top" width="76.32%" headers="mcps1.2.3.1.2 "><p id="zh-cn_topic_0180960136_p1984795517493"><a name="zh-cn_topic_0180960136_p1984795517493"></a><a name="zh-cn_topic_0180960136_p1984795517493"></a>数据库实例的主机名或IP地址。</p>
    </td>
    </tr>
    <tr id="zh-cn_topic_0180960136_row198487551499"><td class="cellrowborder" valign="top" width="23.68%" headers="mcps1.2.3.1.1 "><p id="zh-cn_topic_0180960136_p1885075554910"><a name="zh-cn_topic_0180960136_p1885075554910"></a><a name="zh-cn_topic_0180960136_p1885075554910"></a>端口/实例名称</p>
    </td>
    <td class="cellrowborder" valign="top" width="76.32%" headers="mcps1.2.3.1.2 "><p id="zh-cn_topic_0180960136_p17853175520495"><a name="zh-cn_topic_0180960136_p17853175520495"></a><a name="zh-cn_topic_0180960136_p17853175520495"></a><span class="parmname" id="zh-cn_topic_0180960136_parmname1385445520493"><a name="zh-cn_topic_0180960136_parmname1385445520493"></a><a name="zh-cn_topic_0180960136_parmname1385445520493"></a>“数据库类型”</span>选择<span class="parmvalue" id="zh-cn_topic_0180960136_parmvalue1285555554916"><a name="zh-cn_topic_0180960136_parmvalue1285555554916"></a><a name="zh-cn_topic_0180960136_parmvalue1285555554916"></a>“MS-SQL”</span>时显示该参数。</p>
    <p id="zh-cn_topic_0180960136_p085717557493"><a name="zh-cn_topic_0180960136_p085717557493"></a><a name="zh-cn_topic_0180960136_p085717557493"></a>用户数据库的连接端口或实例名称，用于连接到数据库，例如，用户创建的RDS SQL Server的端口为<span class="parmvalue" id="zh-cn_topic_0180960136_parmvalue198571255194910"><a name="zh-cn_topic_0180960136_parmvalue198571255194910"></a><a name="zh-cn_topic_0180960136_parmvalue198571255194910"></a>“8433”</span>。</p>
    </td>
    </tr>
    <tr id="zh-cn_topic_0180960136_row17858125519498"><td class="cellrowborder" valign="top" width="23.68%" headers="mcps1.2.3.1.1 "><p id="zh-cn_topic_0180960136_p148591655124913"><a name="zh-cn_topic_0180960136_p148591655124913"></a><a name="zh-cn_topic_0180960136_p148591655124913"></a>端口</p>
    </td>
    <td class="cellrowborder" valign="top" width="76.32%" headers="mcps1.2.3.1.2 "><p id="zh-cn_topic_0180960136_p086355513497"><a name="zh-cn_topic_0180960136_p086355513497"></a><a name="zh-cn_topic_0180960136_p086355513497"></a><span class="parmname" id="zh-cn_topic_0180960136_parmname586345514914"><a name="zh-cn_topic_0180960136_parmname586345514914"></a><a name="zh-cn_topic_0180960136_parmname586345514914"></a>“数据库类型”</span>选择<span class="parmvalue" id="zh-cn_topic_0180960136_parmvalue17864655174915"><a name="zh-cn_topic_0180960136_parmvalue17864655174915"></a><a name="zh-cn_topic_0180960136_parmvalue17864655174915"></a>“MySQL”</span>、<span class="parmvalue" id="zh-cn_topic_0180960136_parmvalue118646553498"><a name="zh-cn_topic_0180960136_parmvalue118646553498"></a><a name="zh-cn_topic_0180960136_parmvalue118646553498"></a>“PostgreSQL”</span>或<span class="parmvalue" id="zh-cn_topic_0180960136_parmvalue14866135524916"><a name="zh-cn_topic_0180960136_parmvalue14866135524916"></a><a name="zh-cn_topic_0180960136_parmvalue14866135524916"></a>“LibrA/DWS”</span>时显示该参数。</p>
    <p id="zh-cn_topic_0180960136_p2086675519494"><a name="zh-cn_topic_0180960136_p2086675519494"></a><a name="zh-cn_topic_0180960136_p2086675519494"></a>端口为数据库的连接端口，例如，MySQL默认为<span class="parmvalue" id="zh-cn_topic_0180960136_parmvalue78671355184918"><a name="zh-cn_topic_0180960136_parmvalue78671355184918"></a><a name="zh-cn_topic_0180960136_parmvalue78671355184918"></a>“3306”</span>端口，或者用户创建RDS MySQL数据库时，系统分配的端口（<span class="parmvalue" id="zh-cn_topic_0180960136_parmvalue186911551493"><a name="zh-cn_topic_0180960136_parmvalue186911551493"></a><a name="zh-cn_topic_0180960136_parmvalue186911551493"></a>“8635”</span>），用户可以根据情况自己配置。</p>
    </td>
    </tr>
    <tr id="zh-cn_topic_0180960136_row686925511491"><td class="cellrowborder" valign="top" width="23.68%" headers="mcps1.2.3.1.1 "><p id="zh-cn_topic_0180960136_p1187155515496"><a name="zh-cn_topic_0180960136_p1187155515496"></a><a name="zh-cn_topic_0180960136_p1187155515496"></a>名称</p>
    </td>
    <td class="cellrowborder" valign="top" width="76.32%" headers="mcps1.2.3.1.2 "><p id="zh-cn_topic_0180960136_p487555594918"><a name="zh-cn_topic_0180960136_p487555594918"></a><a name="zh-cn_topic_0180960136_p487555594918"></a>连接的数据库实例的别名，HexaTier会自动生成名称，用户可以自定义该名称。</p>
    </td>
    </tr>
    <tr id="zh-cn_topic_0180960136_row11875155174920"><td class="cellrowborder" valign="top" width="23.68%" headers="mcps1.2.3.1.1 "><p id="zh-cn_topic_0180960136_p148772055114914"><a name="zh-cn_topic_0180960136_p148772055114914"></a><a name="zh-cn_topic_0180960136_p148772055114914"></a>默认数据库</p>
    </td>
    <td class="cellrowborder" valign="top" width="76.32%" headers="mcps1.2.3.1.2 "><p id="zh-cn_topic_0180960136_p188791955144920"><a name="zh-cn_topic_0180960136_p188791955144920"></a><a name="zh-cn_topic_0180960136_p188791955144920"></a>HexaTier将自动连接到数据库实例中的默认数据库，用户也可以更改默认数据库。</p>
    <a name="zh-cn_topic_0180960136_ul11881185544915"></a><a name="zh-cn_topic_0180960136_ul11881185544915"></a><ul id="zh-cn_topic_0180960136_ul11881185544915"><li>MS-SQL默认数据库为<span class="parmvalue" id="zh-cn_topic_0180960136_parmvalue2886955144919"><a name="zh-cn_topic_0180960136_parmvalue2886955144919"></a><a name="zh-cn_topic_0180960136_parmvalue2886955144919"></a>“master”</span>。</li><li>MySQL默认数据库为<span class="parmvalue" id="zh-cn_topic_0180960136_parmvalue589065514495"><a name="zh-cn_topic_0180960136_parmvalue589065514495"></a><a name="zh-cn_topic_0180960136_parmvalue589065514495"></a>“mysql”</span>。</li><li>PostgreSQL默认数据库为<span class="parmvalue" id="zh-cn_topic_0180960136_parmvalue1389405564913"><a name="zh-cn_topic_0180960136_parmvalue1389405564913"></a><a name="zh-cn_topic_0180960136_parmvalue1389405564913"></a>“postgres”</span>。</li><li>LibrA/DWS默认数据库为<span class="parmvalue" id="zh-cn_topic_0180960136_parmvalue13897165512494"><a name="zh-cn_topic_0180960136_parmvalue13897165512494"></a><a name="zh-cn_topic_0180960136_parmvalue13897165512494"></a>“postgres”</span>。</li></ul>
    </td>
    </tr>
    <tr id="zh-cn_topic_0180960136_row4898755134911"><td class="cellrowborder" valign="top" width="23.68%" headers="mcps1.2.3.1.1 "><p id="zh-cn_topic_0180960136_p10900165511493"><a name="zh-cn_topic_0180960136_p10900165511493"></a><a name="zh-cn_topic_0180960136_p10900165511493"></a>鉴权方式</p>
    </td>
    <td class="cellrowborder" valign="top" width="76.32%" headers="mcps1.2.3.1.2 "><p id="zh-cn_topic_0180960136_p6902105524911"><a name="zh-cn_topic_0180960136_p6902105524911"></a><a name="zh-cn_topic_0180960136_p6902105524911"></a>通过登录帐户连接数据库，选择：</p>
    <a name="zh-cn_topic_0180960136_ul179041755104911"></a><a name="zh-cn_topic_0180960136_ul179041755104911"></a><ul id="zh-cn_topic_0180960136_ul179041755104911"><li>SQL鉴权：通过SQL帐户连接。</li><li>Windows鉴权：通过Windows鉴权连接。</li></ul>
    <div class="note" id="zh-cn_topic_0180960136_note14907195512491"><a name="zh-cn_topic_0180960136_note14907195512491"></a><a name="zh-cn_topic_0180960136_note14907195512491"></a><span class="notetitle"> 说明： </span><div class="notebody"><p id="zh-cn_topic_0111166360_zh-cn_topic_0180960218_zh-cn_topic_0076429733_p696712166439"><a name="zh-cn_topic_0111166360_zh-cn_topic_0180960218_zh-cn_topic_0076429733_p696712166439"></a><a name="zh-cn_topic_0111166360_zh-cn_topic_0180960218_zh-cn_topic_0076429733_p696712166439"></a>需要配置域集成之后，才会显示<span class="parmvalue" id="zh-cn_topic_0111166360_zh-cn_topic_0180960218_pa843c959c0394687968312ce53270923"><a name="zh-cn_topic_0111166360_zh-cn_topic_0180960218_pa843c959c0394687968312ce53270923"></a><a name="zh-cn_topic_0111166360_zh-cn_topic_0180960218_pa843c959c0394687968312ce53270923"></a>“Windows鉴权”</span>选项，否则默认为<span class="parmvalue" id="zh-cn_topic_0111166360_zh-cn_topic_0180960218_pa03dc91132224efcaa78618c298997f7"><a name="zh-cn_topic_0111166360_zh-cn_topic_0180960218_pa03dc91132224efcaa78618c298997f7"></a><a name="zh-cn_topic_0111166360_zh-cn_topic_0180960218_pa03dc91132224efcaa78618c298997f7"></a>“SQL鉴权”</span>。配置域集成，请参见<a href="配置活动目录.md#section56485498126">配置域集成模式</a>。</p>
    </div></div>
    </td>
    </tr>
    <tr id="zh-cn_topic_0180960136_row1691311555498"><td class="cellrowborder" valign="top" width="23.68%" headers="mcps1.2.3.1.1 "><p id="zh-cn_topic_0180960136_p79165551496"><a name="zh-cn_topic_0180960136_p79165551496"></a><a name="zh-cn_topic_0180960136_p79165551496"></a>用户名</p>
    </td>
    <td class="cellrowborder" valign="top" width="76.32%" headers="mcps1.2.3.1.2 "><p id="zh-cn_topic_0180960136_p19176557498"><a name="zh-cn_topic_0180960136_p19176557498"></a><a name="zh-cn_topic_0180960136_p19176557498"></a>用于登录到数据库的用户名。</p>
    </td>
    </tr>
    <tr id="zh-cn_topic_0180960136_row17918455174920"><td class="cellrowborder" valign="top" width="23.68%" headers="mcps1.2.3.1.1 "><p id="zh-cn_topic_0180960136_p14919135517494"><a name="zh-cn_topic_0180960136_p14919135517494"></a><a name="zh-cn_topic_0180960136_p14919135517494"></a>密码</p>
    </td>
    <td class="cellrowborder" valign="top" width="76.32%" headers="mcps1.2.3.1.2 "><p id="zh-cn_topic_0180960136_p392175564910"><a name="zh-cn_topic_0180960136_p392175564910"></a><a name="zh-cn_topic_0180960136_p392175564910"></a>用于登录到数据库的密码。</p>
    </td>
    </tr>
    </tbody>
    </table>

5.  （可选）设置代理，并配置其SSL安全。

    >![](public_sys-resources/icon-note.gif) **说明：**   
    >-   创建受保护数据库时，HexaTier会自动创建默认代理，用户也可以对其进行修改。  
    >-   代理可以被设置为旁路模式（不检查进出数据库的流量）：  
    >    -   手动设置旁路模式：更改代理的状态为“旁路“模式，参见[表2](#zh-cn_topic_0180960136_t2d9df6921eea4419b16136a77c1d9272)。  
    >    -   系统自动切换旁路模式：当HexaTier服务因为故障而不可用时，会自动切换为旁路模式。当故障修复后，需重启HexaTier服务，代理状态才会更改为“激活“。  

    1.  单击“高级代理配置“。

        **图 2**  高级代理配置图<a name="zh-cn_topic_0180960136_fig68741339205317"></a>  
        ![](figures/高级代理配置图.png "高级代理配置图")

    2.  根据需要设置下表中的参数：

    **表 2**  高级代理配置参数

    <a name="zh-cn_topic_0180960136_t2d9df6921eea4419b16136a77c1d9272"></a>
    <table><thead align="left"><tr id="zh-cn_topic_0180960136_rce3db8a3bf7a4d74be9cd0e632e73cb0"><th class="cellrowborder" valign="top" width="24.81%" id="mcps1.2.3.1.1"><p id="zh-cn_topic_0180960136_a4b358a1cec5a4490a61bdeb25fda895b"><a name="zh-cn_topic_0180960136_a4b358a1cec5a4490a61bdeb25fda895b"></a><a name="zh-cn_topic_0180960136_a4b358a1cec5a4490a61bdeb25fda895b"></a>参数名称</p>
    </th>
    <th class="cellrowborder" valign="top" width="75.19%" id="mcps1.2.3.1.2"><p id="zh-cn_topic_0180960136_a86529d5922b84988ba4564bda992c982"><a name="zh-cn_topic_0180960136_a86529d5922b84988ba4564bda992c982"></a><a name="zh-cn_topic_0180960136_a86529d5922b84988ba4564bda992c982"></a>说明</p>
    </th>
    </tr>
    </thead>
    <tbody><tr id="zh-cn_topic_0180960136_r9dd6750f36de485cbe6db7e321a7e158"><td class="cellrowborder" valign="top" width="24.81%" headers="mcps1.2.3.1.1 "><p id="zh-cn_topic_0180960136_a7936a8f1a0e54ababede8daba56decc7"><a name="zh-cn_topic_0180960136_a7936a8f1a0e54ababede8daba56decc7"></a><a name="zh-cn_topic_0180960136_a7936a8f1a0e54ababede8daba56decc7"></a>代理标签</p>
    </td>
    <td class="cellrowborder" valign="top" width="75.19%" headers="mcps1.2.3.1.2 "><p id="zh-cn_topic_0180960136_a3a96bd2fded24b63abe149e9a5830df3"><a name="zh-cn_topic_0180960136_a3a96bd2fded24b63abe149e9a5830df3"></a><a name="zh-cn_topic_0180960136_a3a96bd2fded24b63abe149e9a5830df3"></a>代理的逻辑名称。用户可以自定义该名称。</p>
    </td>
    </tr>
    <tr id="zh-cn_topic_0180960136_r2153b344093d49d1999f15583dc8740c"><td class="cellrowborder" valign="top" width="24.81%" headers="mcps1.2.3.1.1 "><p id="zh-cn_topic_0180960136_zh-cn_topic_0076429774_p624181211196"><a name="zh-cn_topic_0180960136_zh-cn_topic_0076429774_p624181211196"></a><a name="zh-cn_topic_0180960136_zh-cn_topic_0076429774_p624181211196"></a>监听地址</p>
    </td>
    <td class="cellrowborder" valign="top" width="75.19%" headers="mcps1.2.3.1.2 "><p id="zh-cn_topic_0180960136_a4a26d73fddb54be3a4f5a21bdaff5220"><a name="zh-cn_topic_0180960136_a4a26d73fddb54be3a4f5a21bdaff5220"></a><a name="zh-cn_topic_0180960136_a4a26d73fddb54be3a4f5a21bdaff5220"></a>指定用户想要代理监听的IP地址。</p>
    <p id="zh-cn_topic_0180960136_a0ca649fa54ff481ab80b0d9cb9f6a187"><a name="zh-cn_topic_0180960136_a0ca649fa54ff481ab80b0d9cb9f6a187"></a><a name="zh-cn_topic_0180960136_a0ca649fa54ff481ab80b0d9cb9f6a187"></a>用户可以使用0.0.0.0来监听所有IP。</p>
    </td>
    </tr>
    <tr id="zh-cn_topic_0180960136_r1148b97b47074aaa9907541a274aefdd"><td class="cellrowborder" valign="top" width="24.81%" headers="mcps1.2.3.1.1 "><p id="zh-cn_topic_0180960136_a8f3ea9816b8a4164b8a555c3274f82f5"><a name="zh-cn_topic_0180960136_a8f3ea9816b8a4164b8a555c3274f82f5"></a><a name="zh-cn_topic_0180960136_a8f3ea9816b8a4164b8a555c3274f82f5"></a>端口</p>
    </td>
    <td class="cellrowborder" valign="top" width="75.19%" headers="mcps1.2.3.1.2 "><p id="zh-cn_topic_0180960136_zh-cn_topic_0076429774_p353710214"><a name="zh-cn_topic_0180960136_zh-cn_topic_0076429774_p353710214"></a><a name="zh-cn_topic_0180960136_zh-cn_topic_0076429774_p353710214"></a>端口为HexaTier的连接端口，建议与数据库端口相同，若相同端口已占用，用户可以配置除0~1023、5000和其他已占用端口之外的任一可用端口。</p>
    </td>
    </tr>
    <tr id="zh-cn_topic_0180960136_rc725a11c584743f9bbac22059d1861b6"><td class="cellrowborder" valign="top" width="24.81%" headers="mcps1.2.3.1.1 "><p id="zh-cn_topic_0180960136_a16059d1a87944f9faf8ca27c82721109"><a name="zh-cn_topic_0180960136_a16059d1a87944f9faf8ca27c82721109"></a><a name="zh-cn_topic_0180960136_a16059d1a87944f9faf8ca27c82721109"></a>状态</p>
    </td>
    <td class="cellrowborder" valign="top" width="75.19%" headers="mcps1.2.3.1.2 "><p id="zh-cn_topic_0180960136_zh-cn_topic_0076429774_p024116120194"><a name="zh-cn_topic_0180960136_zh-cn_topic_0076429774_p024116120194"></a><a name="zh-cn_topic_0180960136_zh-cn_topic_0076429774_p024116120194"></a>选择下列选项之一：</p>
    <a name="zh-cn_topic_0180960136_u65e337196e454ad291b38e61735fa1bf"></a><a name="zh-cn_topic_0180960136_u65e337196e454ad291b38e61735fa1bf"></a><ul id="zh-cn_topic_0180960136_u65e337196e454ad291b38e61735fa1bf"><li>激活：激活代理。</li><li>禁用：禁用代理。</li><li>旁路：流量将不经过检查直接转发给数据库（不安全）。</li></ul>
    </td>
    </tr>
    <tr id="zh-cn_topic_0180960136_r15b74c379a7f457c9df7277a889ba63a"><td class="cellrowborder" valign="top" width="24.81%" headers="mcps1.2.3.1.1 "><p id="zh-cn_topic_0180960136_zh-cn_topic_0076429774_p142413127199"><a name="zh-cn_topic_0180960136_zh-cn_topic_0076429774_p142413127199"></a><a name="zh-cn_topic_0180960136_zh-cn_topic_0076429774_p142413127199"></a>鉴权代理</p>
    </td>
    <td class="cellrowborder" valign="top" width="75.19%" headers="mcps1.2.3.1.2 "><p id="zh-cn_topic_0180960136_zh-cn_topic_0076429774_p106922210150"><a name="zh-cn_topic_0180960136_zh-cn_topic_0076429774_p106922210150"></a><a name="zh-cn_topic_0180960136_zh-cn_topic_0076429774_p106922210150"></a><span class="parmname" id="zh-cn_topic_0180960136_p7e0c6895823a4d018d6234e4801f785b"><a name="zh-cn_topic_0180960136_p7e0c6895823a4d018d6234e4801f785b"></a><a name="zh-cn_topic_0180960136_p7e0c6895823a4d018d6234e4801f785b"></a>“鉴权代理”</span>仅在配置了域集成时显示并可用。</p>
    <p id="zh-cn_topic_0180960136_zh-cn_topic_0076429774_p624121231911"><a name="zh-cn_topic_0180960136_zh-cn_topic_0076429774_p624121231911"></a><a name="zh-cn_topic_0180960136_zh-cn_topic_0076429774_p624121231911"></a>此功能使HexaTier能够使用活动目录鉴别客户端的凭证，并使用不同的凭证连接到数据库，包括下列选项：</p>
    <a name="zh-cn_topic_0180960136_ub17f1158e28847aebd6066a6af7667fe"></a><a name="zh-cn_topic_0180960136_ub17f1158e28847aebd6066a6af7667fe"></a><ul id="zh-cn_topic_0180960136_ub17f1158e28847aebd6066a6af7667fe"><li>同上：使用上述配置的Windows鉴权相同的用户名和密码。</li><li>SQL鉴权：允许用户指定自己的用户名和密码。</li></ul>
    <div class="note" id="zh-cn_topic_0180960136_n77a1d7ff5c994534b188aca1c42924d9"><a name="zh-cn_topic_0180960136_n77a1d7ff5c994534b188aca1c42924d9"></a><a name="zh-cn_topic_0180960136_n77a1d7ff5c994534b188aca1c42924d9"></a><span class="notetitle"> 说明： </span><div class="notebody"><a name="zh-cn_topic_0180960136_u0d16cd061ad94f32bc21097273997eaa"></a><a name="zh-cn_topic_0180960136_u0d16cd061ad94f32bc21097273997eaa"></a><ul id="zh-cn_topic_0180960136_u0d16cd061ad94f32bc21097273997eaa"><li>配置域集成，请参见<a href="配置活动目录.md#section56485498126">配置域集成模式</a>。</li><li>鉴权代理功能可用于所有支持的数据库。</li><li>提供的用户名和密码将决定派生代理权限。</li></ul>
    </div></div>
    </td>
    </tr>
    <tr id="zh-cn_topic_0180960136_r302b76f087734dceb1a828d3e3471327"><td class="cellrowborder" valign="top" width="24.81%" headers="mcps1.2.3.1.1 "><p id="zh-cn_topic_0180960136_a173a250b619c479a938823830f39dd29"><a name="zh-cn_topic_0180960136_a173a250b619c479a938823830f39dd29"></a><a name="zh-cn_topic_0180960136_a173a250b619c479a938823830f39dd29"></a>SSL证书</p>
    </td>
    <td class="cellrowborder" valign="top" width="75.19%" headers="mcps1.2.3.1.2 "><p id="zh-cn_topic_0180960136_aaef2411a37554456bd15b61335c1bb72"><a name="zh-cn_topic_0180960136_aaef2411a37554456bd15b61335c1bb72"></a><a name="zh-cn_topic_0180960136_aaef2411a37554456bd15b61335c1bb72"></a>在列表中，选择证书。</p>
    <div class="note" id="zh-cn_topic_0180960136_n45523a6698c046989c52afdb5ce88ff5"><a name="zh-cn_topic_0180960136_n45523a6698c046989c52afdb5ce88ff5"></a><a name="zh-cn_topic_0180960136_n45523a6698c046989c52afdb5ce88ff5"></a><span class="notetitle"> 说明： </span><div class="notebody"><a name="zh-cn_topic_0180960136_zh-cn_topic_0076429774_ul20472754403"></a><a name="zh-cn_topic_0180960136_zh-cn_topic_0076429774_ul20472754403"></a><ul id="zh-cn_topic_0180960136_zh-cn_topic_0076429774_ul20472754403"><li>用户可以导入其他证书，更多信息，请参见<a href="配置SSL安全.md#section108081657248">上传入方向证书</a>。</li><li>如果客户端中尚未提供所需的SSL证书，请单击<a name="image20838414492"></a><a name="image20838414492"></a><span><img id="image20838414492" src="figures/icon-imsa.png"></span>，向客户端导入证书。</li></ul>
    </div></div>
    </td>
    </tr>
    <tr id="zh-cn_topic_0180960136_r659c115d9d1c4a46826b43997ae33af9"><td class="cellrowborder" valign="top" width="24.81%" headers="mcps1.2.3.1.1 "><p id="zh-cn_topic_0180960136_a6a85c126145548d0985729976b4b5b7f"><a name="zh-cn_topic_0180960136_a6a85c126145548d0985729976b4b5b7f"></a><a name="zh-cn_topic_0180960136_a6a85c126145548d0985729976b4b5b7f"></a>阻止未加密的连接</p>
    </td>
    <td class="cellrowborder" valign="top" width="75.19%" headers="mcps1.2.3.1.2 "><p id="zh-cn_topic_0180960136_zh-cn_topic_0076429774_p202437122192"><a name="zh-cn_topic_0180960136_zh-cn_topic_0076429774_p202437122192"></a><a name="zh-cn_topic_0180960136_zh-cn_topic_0076429774_p202437122192"></a>建议用户选中该复选框，要求所有通信都加密，并阻止未加密的连接。</p>
    <p id="zh-cn_topic_0180960136_aeed07fcc3c384e9ea8c1245ef51f454e"><a name="zh-cn_topic_0180960136_aeed07fcc3c384e9ea8c1245ef51f454e"></a><a name="zh-cn_topic_0180960136_aeed07fcc3c384e9ea8c1245ef51f454e"></a>若不选择，则该代理的所有通信均不加密，通信存在安全隐患。</p>
    </td>
    </tr>
    </tbody>
    </table>

    >![](public_sys-resources/icon-note.gif) **说明：**   
    >-   如果要添加多个代理，请单击“添加代理“。  
    >-   用户可以修改入方向的最低SSL安全设置。有关更多信息，请参见[设置入方向SSL安全](配置SSL安全.md#section131019291349)。  

6.  （可选）单击“测试“，测试连接。

    >![](public_sys-resources/icon-note.gif) **说明：**   
    >使用测试连接是可选的，因为保存时会自动测试用户的连接和安全设置。  

7.  单击“创建“或“更新“。

    保存功能会测试SSL设置，如果设置有效，则会验证用户凭证，并显示下表的测试结果。   

    **表 3**  测试结果

    <a name="zh-cn_topic_0180960136_t0d267a9341674fca8e0baf90bdbc7b43"></a>
    <table><thead align="left"><tr id="zh-cn_topic_0180960136_r947cb73634d24ed9b923abdcddf74dc9"><th class="cellrowborder" valign="top" width="20%" id="mcps1.2.6.1.1"><p id="zh-cn_topic_0180960136_ac5c1827d66ff40bfa3be2b59cc7c4340"><a name="zh-cn_topic_0180960136_ac5c1827d66ff40bfa3be2b59cc7c4340"></a><a name="zh-cn_topic_0180960136_ac5c1827d66ff40bfa3be2b59cc7c4340"></a>测试结果</p>
    </th>
    <th class="cellrowborder" valign="top" width="20%" id="mcps1.2.6.1.2"><p id="zh-cn_topic_0180960136_afe7b33ae5a27457b815b93ddc9e3e92e"><a name="zh-cn_topic_0180960136_afe7b33ae5a27457b815b93ddc9e3e92e"></a><a name="zh-cn_topic_0180960136_afe7b33ae5a27457b815b93ddc9e3e92e"></a>说明</p>
    </th>
    <th class="cellrowborder" valign="top" width="20%" id="mcps1.2.6.1.3"><p id="zh-cn_topic_0180960136_ad104adcf441a4f878cdb7cae6de34b25"><a name="zh-cn_topic_0180960136_ad104adcf441a4f878cdb7cae6de34b25"></a><a name="zh-cn_topic_0180960136_ad104adcf441a4f878cdb7cae6de34b25"></a>应对选项1</p>
    </th>
    <th class="cellrowborder" valign="top" width="20%" id="mcps1.2.6.1.4"><p id="zh-cn_topic_0180960136_zh-cn_topic_0076429774_p462298691348"><a name="zh-cn_topic_0180960136_zh-cn_topic_0076429774_p462298691348"></a><a name="zh-cn_topic_0180960136_zh-cn_topic_0076429774_p462298691348"></a>应对选项2</p>
    </th>
    <th class="cellrowborder" valign="top" width="20%" id="mcps1.2.6.1.5"><p id="zh-cn_topic_0180960136_aa7bc2103aff5493491a1e6635b717741"><a name="zh-cn_topic_0180960136_aa7bc2103aff5493491a1e6635b717741"></a><a name="zh-cn_topic_0180960136_aa7bc2103aff5493491a1e6635b717741"></a>应对选项3</p>
    </th>
    </tr>
    </thead>
    <tbody><tr id="zh-cn_topic_0180960136_r009dccec01944c8eb900f0d218f38728"><td class="cellrowborder" valign="top" width="20%" headers="mcps1.2.6.1.1 "><p id="zh-cn_topic_0180960136_ac239957d673a4c57b84b498315b0dcfd"><a name="zh-cn_topic_0180960136_ac239957d673a4c57b84b498315b0dcfd"></a><a name="zh-cn_topic_0180960136_ac239957d673a4c57b84b498315b0dcfd"></a>成功</p>
    </td>
    <td class="cellrowborder" valign="top" width="20%" headers="mcps1.2.6.1.2 "><p id="zh-cn_topic_0180960136_aa60d1a5e31314afdbb412d31b8057b7a"><a name="zh-cn_topic_0180960136_aa60d1a5e31314afdbb412d31b8057b7a"></a><a name="zh-cn_topic_0180960136_aa60d1a5e31314afdbb412d31b8057b7a"></a>成功连接到受保护的数据库。</p>
    </td>
    <td class="cellrowborder" valign="top" width="20%" headers="mcps1.2.6.1.3 "><p id="zh-cn_topic_0180960136_a69dd905d81614f6db3e4015b4178f868"><a name="zh-cn_topic_0180960136_a69dd905d81614f6db3e4015b4178f868"></a><a name="zh-cn_topic_0180960136_a69dd905d81614f6db3e4015b4178f868"></a>-</p>
    </td>
    <td class="cellrowborder" valign="top" width="20%" headers="mcps1.2.6.1.4 "><p id="zh-cn_topic_0180960136_a98e7cbafc64f4700917e4a182a87a045"><a name="zh-cn_topic_0180960136_a98e7cbafc64f4700917e4a182a87a045"></a><a name="zh-cn_topic_0180960136_a98e7cbafc64f4700917e4a182a87a045"></a>-</p>
    </td>
    <td class="cellrowborder" valign="top" width="20%" headers="mcps1.2.6.1.5 "><p id="zh-cn_topic_0180960136_a599076cecf9f460396044b5c685347b8"><a name="zh-cn_topic_0180960136_a599076cecf9f460396044b5c685347b8"></a><a name="zh-cn_topic_0180960136_a599076cecf9f460396044b5c685347b8"></a>-</p>
    </td>
    </tr>
    <tr id="zh-cn_topic_0180960136_r463a0a61d0bf4e2db47c4b257c1f20da"><td class="cellrowborder" valign="top" width="20%" headers="mcps1.2.6.1.1 "><p id="zh-cn_topic_0180960136_a2fc6370a4ef4461aa5a01a93abd60408"><a name="zh-cn_topic_0180960136_a2fc6370a4ef4461aa5a01a93abd60408"></a><a name="zh-cn_topic_0180960136_a2fc6370a4ef4461aa5a01a93abd60408"></a>受保护数据库服务器不支持SSL</p>
    </td>
    <td class="cellrowborder" valign="top" width="20%" headers="mcps1.2.6.1.2 "><p id="zh-cn_topic_0180960136_a57f19d03ab9040138c8e0f8ee587f1ab"><a name="zh-cn_topic_0180960136_a57f19d03ab9040138c8e0f8ee587f1ab"></a><a name="zh-cn_topic_0180960136_a57f19d03ab9040138c8e0f8ee587f1ab"></a>根据提供的参数无法建立SSL连接。</p>
    </td>
    <td class="cellrowborder" valign="top" width="20%" headers="mcps1.2.6.1.3 "><p id="zh-cn_topic_0180960136_ab6c2646960184646bc4138aef7c4a1ae"><a name="zh-cn_topic_0180960136_ab6c2646960184646bc4138aef7c4a1ae"></a><a name="zh-cn_topic_0180960136_ab6c2646960184646bc4138aef7c4a1ae"></a>单击<span class="uicontrol" id="zh-cn_topic_0180960136_uf5bab3948de24627bf124ea3b93cf4dc"><a name="zh-cn_topic_0180960136_uf5bab3948de24627bf124ea3b93cf4dc"></a><a name="zh-cn_topic_0180960136_uf5bab3948de24627bf124ea3b93cf4dc"></a>“仍然继续”</span>使用未加密的通信。</p>
    </td>
    <td class="cellrowborder" valign="top" width="20%" headers="mcps1.2.6.1.4 "><p id="zh-cn_topic_0180960136_a7d5ecb8dae8b433ab423ae15d96d77cd"><a name="zh-cn_topic_0180960136_a7d5ecb8dae8b433ab423ae15d96d77cd"></a><a name="zh-cn_topic_0180960136_a7d5ecb8dae8b433ab423ae15d96d77cd"></a>单击<span class="uicontrol" id="zh-cn_topic_0180960136_ub1222f9636bd477d86f92ac4c7f6607b"><a name="zh-cn_topic_0180960136_ub1222f9636bd477d86f92ac4c7f6607b"></a><a name="zh-cn_topic_0180960136_ub1222f9636bd477d86f92ac4c7f6607b"></a>“取消”</span>，对数据库SSL设置进行故障处理，然后重试。</p>
    </td>
    <td class="cellrowborder" valign="top" width="20%" headers="mcps1.2.6.1.5 "><p id="zh-cn_topic_0180960136_a7fbda43e9469409eba54d50649f20d35"><a name="zh-cn_topic_0180960136_a7fbda43e9469409eba54d50649f20d35"></a><a name="zh-cn_topic_0180960136_a7fbda43e9469409eba54d50649f20d35"></a>-</p>
    </td>
    </tr>
    <tr id="zh-cn_topic_0180960136_rf5f655d9a1a14ecda73d03e588de597d"><td class="cellrowborder" valign="top" width="20%" headers="mcps1.2.6.1.1 "><p id="zh-cn_topic_0180960136_a6c1b82442e6043419e4ce573a59d24e0"><a name="zh-cn_topic_0180960136_a6c1b82442e6043419e4ce573a59d24e0"></a><a name="zh-cn_topic_0180960136_a6c1b82442e6043419e4ce573a59d24e0"></a>证书验证失败</p>
    </td>
    <td class="cellrowborder" valign="top" width="20%" headers="mcps1.2.6.1.2 "><p id="zh-cn_topic_0180960136_a5a121e5a77624b24871a278f72ea2ead"><a name="zh-cn_topic_0180960136_a5a121e5a77624b24871a278f72ea2ead"></a><a name="zh-cn_topic_0180960136_a5a121e5a77624b24871a278f72ea2ead"></a>无法验证服务器身份，其安全证书不受HexaTier信任。</p>
    </td>
    <td class="cellrowborder" valign="top" width="20%" headers="mcps1.2.6.1.3 "><p id="zh-cn_topic_0180960136_zh-cn_topic_0076429774_p588718291348"><a name="zh-cn_topic_0180960136_zh-cn_topic_0076429774_p588718291348"></a><a name="zh-cn_topic_0180960136_zh-cn_topic_0076429774_p588718291348"></a>上传新CA证书，然后重试。上传出方向证书的更多信息，请参见<a href="配置SSL安全.md">配置SSL安全</a>。</p>
    </td>
    <td class="cellrowborder" valign="top" width="20%" headers="mcps1.2.6.1.4 "><p id="zh-cn_topic_0180960136_zh-cn_topic_0076429774_p709975791348"><a name="zh-cn_topic_0180960136_zh-cn_topic_0076429774_p709975791348"></a><a name="zh-cn_topic_0180960136_zh-cn_topic_0076429774_p709975791348"></a>单击<span class="uicontrol" id="zh-cn_topic_0180960136_ueae92667ab02400d8aa462b779d56aaf"><a name="zh-cn_topic_0180960136_ueae92667ab02400d8aa462b779d56aaf"></a><a name="zh-cn_topic_0180960136_ueae92667ab02400d8aa462b779d56aaf"></a>“仍然继续”</span>将实例添加到例外表，通信将被加密。</p>
    </td>
    <td class="cellrowborder" valign="top" width="20%" headers="mcps1.2.6.1.5 "><p id="zh-cn_topic_0180960136_a20f5d347624143ab97b49b3b0ebba70e"><a name="zh-cn_topic_0180960136_a20f5d347624143ab97b49b3b0ebba70e"></a><a name="zh-cn_topic_0180960136_a20f5d347624143ab97b49b3b0ebba70e"></a>-</p>
    </td>
    </tr>
    <tr id="zh-cn_topic_0180960136_rb761ff0894a24ec3a65d261a47e2f922"><td class="cellrowborder" valign="top" width="20%" headers="mcps1.2.6.1.1 "><p id="zh-cn_topic_0180960136_zh-cn_topic_0076429774_p450363491348"><a name="zh-cn_topic_0180960136_zh-cn_topic_0076429774_p450363491348"></a><a name="zh-cn_topic_0180960136_zh-cn_topic_0076429774_p450363491348"></a>服务器不符合最低加密级别要求</p>
    </td>
    <td class="cellrowborder" valign="top" width="20%" headers="mcps1.2.6.1.2 "><p id="zh-cn_topic_0180960136_abd7ed354f7904b28bc7bf5bd715e4802"><a name="zh-cn_topic_0180960136_abd7ed354f7904b28bc7bf5bd715e4802"></a><a name="zh-cn_topic_0180960136_abd7ed354f7904b28bc7bf5bd715e4802"></a>服务器不符合管理员设置的最低加密级别要求。</p>
    </td>
    <td class="cellrowborder" valign="top" width="20%" headers="mcps1.2.6.1.3 "><p id="zh-cn_topic_0180960136_a36c23ba407324b419564b3975d8774ff"><a name="zh-cn_topic_0180960136_a36c23ba407324b419564b3975d8774ff"></a><a name="zh-cn_topic_0180960136_a36c23ba407324b419564b3975d8774ff"></a>单击<span class="uicontrol" id="zh-cn_topic_0180960136_uc7baac1a80fb44e685fbbaf0395e542b"><a name="zh-cn_topic_0180960136_uc7baac1a80fb44e685fbbaf0395e542b"></a><a name="zh-cn_topic_0180960136_uc7baac1a80fb44e685fbbaf0395e542b"></a>“取消”</span>，升级数据库上的SSL版本，然后重试。</p>
    </td>
    <td class="cellrowborder" valign="top" width="20%" headers="mcps1.2.6.1.4 "><p id="zh-cn_topic_0180960136_ab80c4cea3c2e40a397081c9a8197d2cf"><a name="zh-cn_topic_0180960136_ab80c4cea3c2e40a397081c9a8197d2cf"></a><a name="zh-cn_topic_0180960136_ab80c4cea3c2e40a397081c9a8197d2cf"></a>单击<span class="uicontrol" id="zh-cn_topic_0180960136_u02a7cab733c44075988707224f1a8b4f"><a name="zh-cn_topic_0180960136_u02a7cab733c44075988707224f1a8b4f"></a><a name="zh-cn_topic_0180960136_u02a7cab733c44075988707224f1a8b4f"></a>“仍然继续”</span>将实例服务器添加到例外表。通信将被加密，但安全设置较低。</p>
    </td>
    <td class="cellrowborder" valign="top" width="20%" headers="mcps1.2.6.1.5 "><p id="zh-cn_topic_0180960136_a9eb4bea5c60047d797551aec2de8a556"><a name="zh-cn_topic_0180960136_a9eb4bea5c60047d797551aec2de8a556"></a><a name="zh-cn_topic_0180960136_a9eb4bea5c60047d797551aec2de8a556"></a>单击<span class="uicontrol" id="zh-cn_topic_0180960136_uf60d626fd8f643eba1f9641213794b06"><a name="zh-cn_topic_0180960136_uf60d626fd8f643eba1f9641213794b06"></a><a name="zh-cn_topic_0180960136_uf60d626fd8f643eba1f9641213794b06"></a>“取消”</span>，降低出方向的SSL安全设置，然后重试。有关出方向安全设置的更多信息，请参见<a href="配置SSL安全.md">配置SSL安全</a>。</p>
    <div class="note" id="zh-cn_topic_0180960136_ncd5ecb0a01bd4f61a36de106ed871f5c"><a name="zh-cn_topic_0180960136_ncd5ecb0a01bd4f61a36de106ed871f5c"></a><a name="zh-cn_topic_0180960136_ncd5ecb0a01bd4f61a36de106ed871f5c"></a><span class="notetitle"> 说明： </span><div class="notebody"><p id="zh-cn_topic_0180960136_a674b194e216b47b3b4504dea8198a2d2"><a name="zh-cn_topic_0180960136_a674b194e216b47b3b4504dea8198a2d2"></a><a name="zh-cn_topic_0180960136_a674b194e216b47b3b4504dea8198a2d2"></a>修改出方向SSL安全设置可能会影响修改后创建的受保护数据库。</p>
    </div></div>
    </td>
    </tr>
    </tbody>
    </table>


>![](public_sys-resources/icon-note.gif) **说明：**   
>-   单击受保护数据库列表行末尾的![](figures/icon-dblist.png)（数据库清单），可以显示关联的数据库。  
>-   单击受保护数据库列表行末尾的![](figures/icon-lock.png)（被策略规则锁定），显示关联该受保护数据库的策略。  
>-   单击受保护数据库列表行末尾的![](figures/icon-delete.png)（删除），可以删除该受保护的数据库。若删除按钮不可用，则需要删除所有关联的策略之后，才能删除受保护的数据库。  

